<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Roster Studio Â· Multi-tenant playground</title>
    <link rel="stylesheet" href="/ui.css" />
    <link rel="stylesheet" href="/roster_builder.css" />
  </head>
  <body>
    <nav class="top-nav">
      <div class="top-nav__inner">
        <div class="brand">
          <span class="brand__title">Roster SaaS</span>
          <span class="brand__subtitle">Tenant workspace</span>
        </div>
        <div class="top-nav__links">
          <a class="nav-link" data-nav="home" href="/index.html">Home</a>
          <a class="nav-link" data-nav="dashboard" href="/location_roster_list.html">Tenant Dashboard</a>
          <a class="nav-link" data-nav="builder" href="/location_roster_builder.html">Roster Builder</a>
          <a class="nav-link" data-nav="list" href="/location_roster_list.html">Roster List</a>
          <a class="nav-link" data-nav="reports" href="/roster_reports_dashboard.html">Reports</a>
        </div>
      </div>
    </nav>

    <main class="page">
      <header class="hero">
        <div>
          <p class="eyebrow">Roster SaaS sandbox</p>
          <h1>Roster Studio</h1>
          <p class="lede">
            Build tenant-scoped rosters in two modes: <strong>rotation</strong> (code-only) or
            <strong>time-bound</strong> (shifts map to time slots). Everything here talks directly to the Express API so you can validate
            the full stack quickly.
          </p>
          <div class="hero__badges">
            <span class="badge badge--primary">Backend: http://localhost:4000</span>
            <span class="badge badge--accent">Header: x-tenant-id</span>
          </div>
        </div>
        <div class="hero__callout">
          <p>Need approvals?</p>
          <h3>COO / SATCO aware</h3>
          <p class="muted">Roster creation enforces approver keywords pulled from the ported metadata.</p>
        </div>
      </header>

      <section class="grid">
        <article class="card">
          <header class="card__header">
            <div>
              <h2>Tenant</h2>
              <p class="card__hint">Create one or paste an existing tenant ID.</p>
            </div>
            <div class="pill pill--soft">Multi-tenant ready</div>
          </header>
          <form id="tenantForm" class="form">
            <label class="form__field">
              <span>Name</span>
              <input name="name" type="text" placeholder="Acme Aviation" required />
            </label>
            <label class="form__field">
              <span>Slug</span>
              <input name="slug" type="text" placeholder="acme-ops" required />
            </label>
            <button type="submit" class="button">Create tenant</button>
          </form>
          <label class="form__field form__field--stacked">
            <span>Active tenant ID (sent as <code>x-tenant-id</code>)</span>
            <input id="tenantId" type="text" placeholder="uuid" />
          </label>
          <p class="card__hint" id="tenantStatus" role="status"></p>
          <p class="card__hint">Tip: Place <strong>tenant.svg</strong> inside <code>frontend/public/icons/</code> to display an icon beside this section.</p>
        </article>

        <article class="card">
          <header class="card__header">
            <div>
              <h2>Roster metadata</h2>
              <p class="card__hint">Pulled from the legacy roster glossary.</p>
            </div>
            <span class="pill pill--subtle" id="formNumber"></span>
          </header>
          <div class="metadata" id="unitList" aria-live="polite"></div>
        </article>

        <article class="card card--wide">
          <header class="card__header">
            <div>
              <h2>Shift options</h2>
              <p class="card__hint">
                Support both rotation-only codes and time-bound shifts with reusable templates.
              </p>
            </div>
            <div class="pill pill--gradient">Rotation + Time-bound</div>
          </header>
          <div class="grid grid--split">
            <form id="shiftTemplateForm" class="form form--inline">
              <h3>Create or update shift template</h3>
              <div class="form__row">
                <label class="form__field">
                  <span>Code</span>
                  <input name="code" type="text" placeholder="AM" required />
                </label>
                <label class="form__field">
                  <span>Name</span>
                  <input name="name" type="text" placeholder="Early shift" />
                </label>
              </div>
              <div class="form__row">
                <label class="form__field">
                  <span>Start time</span>
                  <input name="start_time" type="time" />
                </label>
                <label class="form__field">
                  <span>End time</span>
                  <input name="end_time" type="time" />
                </label>
              </div>
              <label class="form__field">
                <span>Description</span>
                <input name="description" type="text" placeholder="Covers opening hours" />
              </label>
              <button type="submit" class="button">Save template</button>
              <p class="card__hint">Templates auto-populate time-bound rosters.</p>
            </form>
            <div>
              <div class="section__title">
                <h3>Templates</h3>
                <p class="muted">Tenant-scoped codes with optional time slots.</p>
              </div>
              <div class="list" id="shiftTemplateList" aria-live="polite"></div>
            </div>
          </div>
        </article>

        <article class="card">
          <header class="card__header">
            <div>
              <h2>Employees</h2>
              <p class="card__hint">Creates an employee under the active tenant.</p>
            </div>
            <div class="pill pill--subtle">People</div>
          </header>
          <form id="employeeForm" class="form">
            <div class="form__row">
              <label class="form__field">
                <span>Name</span>
                <input name="name" type="text" placeholder="Jane Doe" required />
              </label>
              <label class="form__field">
                <span>Service #</span>
                <input name="service_no" type="text" placeholder="SRV123" required />
              </label>
            </div>
            <div class="form__row">
              <label class="form__field">
                <span>Grade (optional)</span>
                <input name="eg" type="text" placeholder="RII" />
              </label>
              <label class="form__field">
                <span>Location</span>
                <input name="location" type="text" placeholder="HQ" />
              </label>
            </div>
            <button type="submit" class="button">Add employee</button>
          </form>
          <div class="list" id="employeeList" aria-live="polite"></div>
        </article>

        <article class="card">
          <header class="card__header">
            <div>
              <h2>Rosters</h2>
              <p class="card__hint">Choose rotation vs time-bound per roster.</p>
            </div>
            <div class="pill pill--soft">Shift strategy</div>
          </header>
          <form id="rosterForm" class="form">
            <label class="form__field">
              <span>Name</span>
              <input name="name" type="text" placeholder="February Schedule" required />
            </label>
            <div class="form__row">
              <label class="form__field">
                <span>Location</span>
                <input name="location" type="text" placeholder="HQ" required />
              </label>
              <label class="form__field">
                <span>Approved by (role)</span>
                <input name="approved_by_role" type="text" placeholder="COO" />
              </label>
            </div>
            <div class="form__row">
              <label class="form__field">
                <span>Start</span>
                <input name="start_date" type="date" required />
              </label>
              <label class="form__field">
                <span>End</span>
                <input name="end_date" type="date" required />
              </label>
            </div>
            <fieldset class="segmented">
              <legend>Shift mode</legend>
              <label>
                <input type="radio" name="shift_mode" value="rotation" checked /> Rotation (A/B/C codes)
              </label>
              <label>
                <input type="radio" name="shift_mode" value="timebound" /> Time-bound (templates apply times)
              </label>
            </fieldset>
            <button type="submit" class="button">Create roster</button>
          </form>
          <div class="list" id="rosterList" aria-live="polite"></div>
        </article>

        <article class="card card--wide">
          <header class="card__header">
            <div>
              <h2>Roster slots</h2>
              <p class="card__hint">Assign an employee to a roster/day/shift.</p>
            </div>
            <div class="pill pill--subtle" id="slotModeLabel">Rotation</div>
          </header>
          <div class="grid grid--split">
            <form id="slotForm" class="form">
              <label class="form__field">
                <span>Roster</span>
                <select name="roster_id" id="slotRoster"></select>
              </label>
              <label class="form__field">
                <span>Employee</span>
                <select name="employee_id" id="slotEmployee"></select>
              </label>
              <div class="form__row">
                <label class="form__field">
                  <span>Duty date</span>
                  <input name="duty_date" type="date" required />
                </label>
                <label class="form__field">
                  <span>Shift code</span>
                  <input name="shift_code" id="slotShiftCode" type="text" placeholder="M" required />
                </label>
              </div>
              <div class="form__row">
                <label class="form__field">
                  <span>Start time</span>
                  <input name="start_time" id="slotStart" type="time" />
                </label>
                <label class="form__field">
                  <span>End time</span>
                  <input name="end_time" id="slotEnd" type="time" />
                </label>
              </div>
              <p class="card__hint" id="slotHelper">Rotation mode: times optional, codes rotate.</p>
              <button type="submit" class="button">Add slot</button>
            </form>
            <div>
              <div class="section__title">
                <h3>Slots</h3>
                <p class="muted">Latest entries for the selected roster.</p>
              </div>
              <div class="list" id="slotList" aria-live="polite"></div>
            </div>
          </div>
        </article>
      </section>
    </main>

    <script>
      const params = new URLSearchParams(window.location.search);
      const tenantFromQuery = params.get('tenant');
      const storedTenant = localStorage.getItem('rosterTenantId');
      const tenantIdInput = document.getElementById('tenantId');

      function setTenantInput(value) {
        if (!value) return;
        tenantIdInput.value = value;
      }

      setTenantInput(tenantFromQuery || storedTenant || '');

      function updateNavLinks() {
        const tenant = tenantIdInput.value || tenantFromQuery || '';
        document.querySelectorAll('[data-nav]').forEach((link) => {
          const base = link.getAttribute('href');
          const url = tenant ? `${base}?tenant=${encodeURIComponent(tenant)}` : base;
          link.setAttribute('href', url);
        });
      }

      tenantIdInput.addEventListener('input', () => {
        localStorage.setItem('rosterTenantId', tenantIdInput.value.trim());
        updateNavLinks();
      });

      updateNavLinks();
    </script>
    <script src="/roster_builder.js" defer></script>
  </body>
</html>
